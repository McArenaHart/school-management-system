{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}SMS{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link href="{% static 'assets/vendor/css/bootstrap.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/css/dashboard.css' %}" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  </head>

  <body>
    <button id="themeToggle" class="btn btn-light border position-fixed" style="bottom: 18px; right: 18px; z-index: 1100; box-shadow: 0 10px 24px rgba(0,0,0,0.18); border-radius: 50%; width: 44px; height: 44px; display: grid; place-items: center;">
      <span id="themeIcon" aria-hidden="true">dYOz</span>
      <span class="visually-hidden">Toggle theme</span>
    </button>

    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand">
          <div class="dot">S</div>
          <div>
            <div>Schooling</div>
            <small>BusyBee Connect</small>
          </div>
        </div>
        <nav>
          <a href="{% url 'accounts:dashboard' %}" class="{% if request.resolver_match and request.resolver_match.view_name == 'accounts:dashboard' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M0 0h7v7H0zM9 0h7v4H9zM0 9h4v7H0zM6 9h10v7H6z"/></svg>
            <span>Dashboard</span>
          </a>
          <a href="{% url 'academics:my_timetable' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'academics' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M8 0 0 4l8 4 6-3v5h2V4L8 0Zm0 9L3 6.5v3L8 12l5-2.5v-3L8 9Z"/></svg>
            <span>Academics</span>
          </a>
          <a href="{% url 'finance:my_fees' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'finance' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M1 14h14v2H1zm2-3h10v2H3zm2-3h6v2H5zm2-3h2v2H7zm-4 0h2v2H3zm8 0h2v2h-2zM7 2h2V0H7z"/></svg>
            <span>Finance</span>
          </a>
          <a href="{% url 'comms:inbox' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'comms' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M5.5 8a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Zm5 0a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5ZM1 14s1-3 4.5-3S10 14 10 14v2H1Zm8 0s.125-.75.621-1.5C10.33 11.48 11.5 11 12.5 11 16 11 17 14 17 14v2H9Z"/></svg>
            <span>Comms</span>
          </a>
          <a href="{% url 'reports:dashboard' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'reports' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M2 0h9l3 3v13H2zM3 1v14h9V4H9V1zm2 5h5v1H5zm0 3h5v1H5zm0 3h3v1H5z"/></svg>
            <span>Reports</span>
          </a>
          {% if request.user.is_principal or request.user.is_school_admin %}
            <a href="{% url 'core:settings' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'core' %}active{% endif %}">
              <svg viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0Zm0 3.5a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9Zm0 2a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5Z"/></svg>
              <span>Core</span>
            </a>
          {% endif %}
          <a href="{% url 'rbac:home' %}" class="{% if request.resolver_match and request.resolver_match.app_name == 'rbac' %}active{% endif %}">
            <svg viewBox="0 0 16 16"><path d="M9.6 1.2 8 0 6.4 1.2 4.3.8 3.8 3 2 4l.5 2L2 8l1.8 1-.5 2 2.1.4L8 12l1.6 1.2 2.1-.4.5-2L14 8l-.5-2L14 4l-1.8-1 .5-2zM8 4.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7z"/></svg>
            <span>System</span>
          </a>
        </nav>
      </aside>

      <div class="workspace">
        <header class="top-bar">
          <div class="actions">
            <a href="#" class="text-muted">Help</a>
            {% if request.user.is_authenticated %}
              <div class="avatar">{{ request.user.username|slice:":1"|upper }}</div>
            {% else %}
              <a href="{% url 'accounts:login' %}" class="cta">Login</a>
            {% endif %}
          </div>
        </header>

        <div class="workspace-body">
          {% block hero %}{% endblock %}

          <div class="page-panel">
            {% if messages %}
              <div class="mb-3">
                {% for m in messages %}
                  {% if "error" in m.tags %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  {% elif "warning" in m.tags %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                  {% elif "success" in m.tags %}
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                  {% else %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                  {% endif %}
                      {{ m }}
                      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
              </div>
            {% endif %}
            {% if form and form.errors %}
              <div class="alert alert-danger">
                Please fix the highlighted errors below.
                {% if form.non_field_errors %}
                  <div class="mt-2 small">{{ form.non_field_errors }}</div>
                {% endif %}
              </div>
            {% endif %}

            {% block content %}{% endblock %}
          </div>
        </div>
      </div>
    </div>

    <script src="{% static 'assets/vendor/js/bootstrap.bundle.min.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
  <script>
    (() => {
      const body = document.body;
      const saved = localStorage.getItem("theme");
      const btn = document.getElementById("themeToggle");
      const icon = document.getElementById("themeIcon");
      const applyIcon = (isDark) => {
        if (!icon) return;
        icon.textContent = isDark ? "dYOT" : "dYOz";
      };

      if (saved === "dark") {
        body.setAttribute("data-theme", "dark");
        applyIcon(true);
      } else {
        applyIcon(false);
      }

      if (btn) {
        btn.addEventListener("click", () => {
          const isDark = body.getAttribute("data-theme") === "dark";
          if (isDark) {
            body.removeAttribute("data-theme");
            localStorage.setItem("theme", "light");
            applyIcon(false);
          } else {
            body.setAttribute("data-theme", "dark");
            localStorage.setItem("theme", "dark");
            applyIcon(true);
          }
        });
      }
    })();
  </script>
</html>
